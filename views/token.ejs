<html>
<head>
<title>ApeRank</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Rank #<%=item.rank%>" />
<meta name="twitter:description" content="Bored Ape <%=item.id%> (Rare factor <%=Math.floor(item.calculated*10000)/10000%>)" />
<meta name="twitter:image" content="https://ipfs.io<%=item.metadata.image%>" />
<meta property="og:url" content="https://aperank.offbase.org" />
<meta property="og:type"   content="website" />
<meta property="og:title" content="Rank #<%=item.rank%>" />
<meta property="og:description" content="Bored Ape <%=item.id%> (Rare factor <%=Math.floor(item.calculated*10000)/10000%>)" />
<meta property="og:image" content="https://ipfs.io<%=item.metadata.image%>" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;1,600;1,900&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  font-family: "Montserrat", sans-serif;
  font-weight: 400;
  font-size: 12px;
  background: rgba(0,0,0,0.9);
  padding: 50px 20px;
}
nav {
  color: white;
  text-align: center;
}
.stretch {
  flex-grow: 1;
}
nav h1 {
  padding: 10px;
}
nav h1 a {
  display: block;
}
h1,h2, .title {
  text-transform: uppercase;
  font-family: "Montserrat", sans-serif;
  font-style: italic;
  font-weight: 900;
  padding: 10px 5px 0;
  margin: 0;
  color: #bfc500;
  font-weight: bold;
  font-size: 30px;
  display: inline-block;
}
nav a {
  color: white;
  text-decoration: none;
  padding: 5px;
}
.editor {
  box-sizing: border-box;
  width: 100%;
  padding: 0 10px;
}
#query {
  background: #bfc500;
  box-sizing: border-box;
  padding: 10px 20px;
  margin: 10px 0 0;
  border: none;
  color: black;
  border-radius: 4px;
  width: 100%;
  cursor: pointer;
  font-weight: bold;
}
.container {
  max-width: 500px;
  margin: 10px auto;
}
.col {
  padding: 30px 0;
}
.row img {
  width: 100%;
  border-radius: 50%;
}
a.tx {
  color: white;
  display: block;
  padding: 5px;
}
td {
  padding: 5px 2px;
  font-size: 14px;
  cursor: pointer;
  color: white;
  vertical-align: top;
}
tr:hover td {
  background: #bfc500;
  color: black;
}
pre {
  white-space: pre-wrap;
  font-size: 12px;
}
img.logo {
  width: 100px;
}
.buttons {
  padding: 20px;
  font-family: Menlo, monaco, Courier;
}
.score {
  font-size: 13px;
  color: white;
  padding: 5px 0;
  font-family: Menlo, monaco, courier, monospace;
}
.score.large {
  font-weight: 900;
  font-size: 40px;
  font-family: Georgia;
  font-style: italic;
}
.rank {
  padding-bottom: 50px;
  text-align: center;
}
.footer a {
  display: flex;
  align-items: center;
  color: white;
  padding: 10px 0;
  text-decoration: none;
}
.footer img, .footer svg {
  height: 50px;
  width: 50px;
  margin-right: 10px;
}
</style>
</head>
<body>
<nav>
  <h1><a href="/"><img class='logo' src="/bayc.png"></a></h1>
</nav>
<div class='flex'>
  <div class='container'>
    <div class='row'>
      <div class='rank'>
        <div class='stretch'></div>
        <div>
          <div class='large score'>Rank #<%=item.rank%></div>
          <div class='score'>Rare Factor: <%=Math.floor(item.calculated * 10000)/10000%></div>
        </div>
      </div>
      <img src="<%=item.metadata.image%>">
      <div class='col'>
        <div class='title'>Ape <%=item.id%></div>
        <% if (item.metadata.attributes) { %>
          <table>
          <% [...item.metadata.attributes].sort((a, b) => { return a.trait_type > b.trait_type  ? 1 : -1 }).forEach((attr) => { %>
            <tr data-attr="<%=JSON.stringify(attr)%>">
              <td><%=attr.trait_type%></td>
              <td><%=attr.value%></td>
              <td><%=Math.ceil(ratio[attr.trait_type][attr.value]*10000)/100%>%</td>
              <td>(<%=stats[attr.trait_type][attr.value]%> of 10,000)</td>
            </tr>
          <% }) %>
          </table>
        <% } %>
      </div>
      <div class='footer'>
        <a href="https://rarible.com/token/0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d:<%=item.id%>">
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="40" height="40" rx="8" fill="#FEDA03"></rect><path d="M27.6007 19.8536C28.8607 19.5262 29.9817 18.5838 29.9817 16.6889C29.9817 13.5342 27.3031 12.8 23.8706 12.8H10.2V27.0064H15.9539V22.185H22.7793C23.8309 22.185 24.446 22.6016 24.446 23.6334V27.0064H30.2V23.4548C30.2 21.5203 29.1087 20.3 27.6007 19.8536ZM22.8785 18.3556H15.9539V16.9667H22.8785C23.6325 16.9667 24.0888 17.0659 24.0888 17.6612C24.0888 18.2564 23.6325 18.3556 22.8785 18.3556Z" fill="black"></path></svg>
          <div>Check out on Rarible</div>
        </a>
        <a href="https://opensea.io/assets/0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d/<%=item.id%>">
          <img src="https://opensea.io/static/images/logos/opensea-logo.png">
          <div>Check out on Opensea</div>
        </a>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener("click", (e) => {
  if (e.target.id === "query") {
    location.href = "/?filter=" + encodeURIComponent(val)
  } else {
    let closest = e.target.closest("tr")
    if (closest) {
      let attr = closest.getAttribute("data-attr")
      if (attr) {
        let a = JSON.parse(attr)
        let query = { "metadata.attributes": { $elemMatch: a } }
        let existingQuery = { $and: [query] }
        let queryStr = JSON.stringify(existingQuery, null, 2)
        location.href = "https://ape.offbase.org/?filter=" + encodeURIComponent(queryStr)
      }
    }
  }
})
</script>
</body>
</html>

